{% comment %}
  Customer Login Form Block
  Provides SMS, Email, and OAuth authentication options
{% endcomment %}

{{ 'login-form.css' | asset_url | stylesheet_tag }}

<div class="customer-login-wrapper" data-customer-login>
  <div class="customer-login-container">
    {% if block.settings.show_logo and block.settings.logo_url != blank %}
      <div class="customer-login-logo">
        <img src="{{ block.settings.logo_url }}" alt="Logo" />
      </div>
    {% endif %}

    <h2 class="customer-login-title">{{ block.settings.title | default: 'Sign In' }}</h2>

    <!-- Error Message Display -->
    <div class="customer-login-error" data-error-message style="display: none;"></div>

    <!-- Success Message Display -->
    <div class="customer-login-success" data-success-message style="display: none;"></div>

    <!-- Authentication Method Tabs -->
    <div class="customer-login-tabs">
      {% if block.settings.show_sms %}
        <button class="customer-login-tab active" data-tab="sms">SMS</button>
      {% endif %}
      {% if block.settings.show_email %}
        <button class="customer-login-tab {% unless block.settings.show_sms %}active{% endunless %}" data-tab="email">Email</button>
      {% endif %}
      {% if block.settings.show_oauth %}
        <button class="customer-login-tab {% unless block.settings.show_sms or block.settings.show_email %}active{% endunless %}" data-tab="oauth">Social</button>
      {% endif %}
    </div>

    <!-- SMS Authentication Form -->
    {% if block.settings.show_sms %}
      <div class="customer-login-form active" data-form="sms">
        <div class="sms-step-1" data-sms-step="1">
          <div class="form-group">
            <label for="phone-number">Phone Number</label>
            <input 
              type="tel" 
              id="phone-number" 
              name="phone" 
              placeholder="+1234567890"
              data-phone-input
              required
            />
          </div>
          <button 
            type="button" 
            class="customer-login-button" 
            data-send-otp
            data-primary-color="{{ block.settings.primary_color }}"
            data-button-style="{{ block.settings.button_style }}"
          >
            <span data-button-text>Send Code</span>
            <span data-button-loader style="display: none;">Sending...</span>
          </button>
        </div>

        <div class="sms-step-2" data-sms-step="2" style="display: none;">
          <p class="sms-instruction">Enter the 6-digit code sent to <strong data-phone-display></strong></p>
          <div class="form-group">
            <label for="otp-code">Verification Code</label>
            <input 
              type="text" 
              id="otp-code" 
              name="code" 
              placeholder="123456"
              maxlength="6"
              pattern="[0-9]{6}"
              data-otp-input
              required
            />
          </div>
          <button 
            type="button" 
            class="customer-login-button" 
            data-verify-otp
            data-primary-color="{{ block.settings.primary_color }}"
            data-button-style="{{ block.settings.button_style }}"
          >
            <span data-button-text>Verify Code</span>
            <span data-button-loader style="display: none;">Verifying...</span>
          </button>
          <button 
            type="button" 
            class="customer-login-link" 
            data-resend-otp
          >
            Resend Code
          </button>
        </div>
      </div>
    {% endif %}

    <!-- Email Authentication Form -->
    {% if block.settings.show_email %}
      <div class="customer-login-form {% unless block.settings.show_sms %}active{% endunless %}" data-form="email">
        <div class="form-group">
          <label for="email">Email Address</label>
          <input 
            type="email" 
            id="email" 
            name="email" 
            placeholder="you@example.com"
            data-email-input
            required
          />
        </div>
        <div class="form-group">
          <label for="password">Password</label>
          <input 
            type="password" 
            id="password" 
            name="password" 
            placeholder="••••••••"
            data-password-input
            required
          />
        </div>
        <button 
          type="button" 
          class="customer-login-button" 
          data-email-login
          data-primary-color="{{ block.settings.primary_color }}"
          data-button-style="{{ block.settings.button_style }}"
        >
          <span data-button-text>Sign In</span>
          <span data-button-loader style="display: none;">Signing in...</span>
        </button>
      </div>
    {% endif %}

    <!-- OAuth Authentication Form -->
    {% if block.settings.show_oauth %}
      <div class="customer-login-form {% unless block.settings.show_sms or block.settings.show_email %}active{% endunless %}" data-form="oauth">
        <p class="oauth-instruction">Sign in with your social account</p>
        <div class="oauth-buttons">
          {% if block.settings.google_enabled %}
            <button 
              type="button" 
              class="oauth-button oauth-button-google" 
              data-oauth-provider="google"
              data-primary-color="{{ block.settings.primary_color }}"
              data-button-style="{{ block.settings.button_style }}"
            >
              <svg width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
                <path d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z" fill="#4285F4"/>
                <path d="M9.003 18c2.43 0 4.467-.806 5.956-2.18L12.05 13.56c-.806.54-1.836.86-3.047.86-2.344 0-4.328-1.584-5.036-3.711H.96v2.332C2.44 15.983 5.485 18 9.003 18z" fill="#34A853"/>
                <path d="M3.964 10.712c-.18-.54-.282-1.117-.282-1.71 0-.593.102-1.17.282-1.71V4.96H.957C.347 6.175 0 7.55 0 9.002c0 1.452.348 2.827.957 4.042l3.007-2.332z" fill="#FBBC05"/>
                <path d="M9.003 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.464.891 11.426 0 9.003 0 5.485 0 2.44 2.017.96 4.958L3.967 7.29c.708-2.127 2.692-3.71 5.036-3.71z" fill="#EA4335"/>
              </svg>
              Continue with Google
            </button>
          {% endif %}

          {% if block.settings.apple_enabled %}
            <button 
              type="button" 
              class="oauth-button oauth-button-apple" 
              data-oauth-provider="apple"
              data-primary-color="{{ block.settings.primary_color }}"
              data-button-style="{{ block.settings.button_style }}"
            >
              <svg width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
                <path d="M14.94 13.52c-.24.54-.36.78-.67 1.26-.43.66-1.04 1.48-1.79 1.49-.66.01-.83-.43-1.73-.42-.9 0-1.06.43-1.72.43-.75.01-1.31-.76-1.74-1.42-1.21-1.85-1.34-4.02-.59-5.17.53-.82 1.37-1.3 2.16-1.3.8 0 1.31.43 1.98.43.64 0 1.03-.43 1.96-.43.7 0 1.44.38 1.97 1.03-1.73 1.01-1.45 3.64.17 4.6zm-2.95-8.71c.35-.45.62-1.08.52-1.71-.56.03-1.21.39-1.59.85-.34.41-.63 1.06-.52 1.67.61.04 1.24-.34 1.59-.81z" fill="currentColor"/>
              </svg>
              Continue with Apple
            </button>
          {% endif %}

          {% if block.settings.facebook_enabled %}
            <button 
              type="button" 
              class="oauth-button oauth-button-facebook" 
              data-oauth-provider="facebook"
              data-primary-color="{{ block.settings.primary_color }}"
              data-button-style="{{ block.settings.button_style }}"
            >
              <svg width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 9.05C18 4.05 13.97 0 9 0S0 4.05 0 9.05C0 13.58 3.29 17.34 7.59 18v-6.3H5.31V9.05h2.28V7.05c0-2.26 1.34-3.51 3.39-3.51.98 0 2.01.18 2.01.18v2.22h-1.13c-1.12 0-1.47.7-1.47 1.41v1.7h2.5l-.4 2.65h-2.1V18C14.71 17.34 18 13.58 18 9.05z" fill="#1877F2"/>
              </svg>
              Continue with Facebook
            </button>
          {% endif %}
        </div>
      </div>
    {% endif %}
  </div>
</div>

{{ 'login-form.js' | asset_url | script_tag }}

<script>
  // Apply custom primary color to buttons
  document.addEventListener('DOMContentLoaded', function() {
    const buttons = document.querySelectorAll('[data-primary-color]');
    buttons.forEach(function(button) {
      const color = button.getAttribute('data-primary-color');
      if (color) {
        button.style.backgroundColor = color;
      }
    });
  });
</script>

{% schema %}
{
  "name": "Customer Login",
  "target": "section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Sign In"
    },
    {
      "type": "header",
      "content": "Authentication Methods"
    },
    {
      "type": "checkbox",
      "id": "show_sms",
      "label": "Show SMS Login",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_email",
      "label": "Show Email Login",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_oauth",
      "label": "Show OAuth Login",
      "default": true
    },
    {
      "type": "header",
      "content": "OAuth Providers"
    },
    {
      "type": "checkbox",
      "id": "google_enabled",
      "label": "Enable Google",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "apple_enabled",
      "label": "Enable Apple",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "facebook_enabled",
      "label": "Enable Facebook",
      "default": false
    },
    {
      "type": "header",
      "content": "Customization"
    },
    {
      "type": "color",
      "id": "primary_color",
      "label": "Primary Color",
      "default": "#000000"
    },
    {
      "type": "select",
      "id": "button_style",
      "label": "Button Style",
      "options": [
        {
          "value": "rounded",
          "label": "Rounded"
        },
        {
          "value": "square",
          "label": "Square"
        }
      ],
      "default": "rounded"
    },
    {
      "type": "checkbox",
      "id": "show_logo",
      "label": "Show Logo",
      "default": false
    },
    {
      "type": "url",
      "id": "logo_url",
      "label": "Logo URL"
    }
  ]
}
{% endschema %}
